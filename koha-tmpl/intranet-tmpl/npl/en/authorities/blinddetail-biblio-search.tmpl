<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<body>
<script language="JavaScript" type="text/javascript">

function go() {
	var tagid = '<!-- TMPL_VAR NAME="tagid" -->';
//	alert("I"+tagid);
	var whichtag = opener.opener.document.getElementById(tagid);
	// parses all the fields of this tag (every id)
	whichsubfields=whichtag.getElementsByTagName("div");
	subfieldcode='';
	for(var i=0; i<whichsubfields.length;i++) {
		// get every <input>
		change_value=whichsubfields[i].getElementsByTagName("input");
		for(j=0;j<change_value.length;j++) {
			// if this <input> if the subfield code, store if for future use !
			if (change_value[j].getAttribute("name") == 'subfield') {
				subfieldcode=subfield_value=change_value[j].value;
//				alert("subfieldcode ="+subfieldcode);
			}
			// if this <input> is for field_value => replace it by the correct value
			if (change_value[j].getAttribute("name") == 'field_value') {
				// empty any previous value, except if we are facing a $4 (UNIMARC specific, does not exist in MARC21)
				if (subfieldcode !=4) {
					change_value[j].value ='';
				}
				// if we are on the $9 replace by authid
				if (subfieldcode=='9') {
// 						alert("subfield 9 valeur <!-- TMPL_VAR NAME="authid" -->");
					change_value[j].value = "<!-- TMPL_VAR NAME="authid" -->";
				}
				// otherwise, build the loop for all subfields to replace
				<!-- TMPL_LOOP NAME="0XX" -->
					<!-- TMPL_LOOP NAME="subfield" -->
						if (subfieldcode == '<!-- TMPL_VAR NAME="marc_subfield" -->') {
// 						alert("subfield"+subfieldcode+" valeur <!-- TMPL_VAR NAME="marc_value" -->");
							change_value[j].value = "<!-- TMPL_VAR NAME="marc_value" -->";
						}
					<!-- /TMPL_LOOP -->
				<!-- /TMPL_LOOP -->
			}
		}
	}
	opener.close();
	self.close();
	return false;


}
</script>
<script language="javascript" type="text/javascript">
window.onload = go();
</script>
</body>
</html>
